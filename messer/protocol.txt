Описание протокола управления соединением

- Протокол текстовый, то есть доступен для отладки через простой telnet

- Команда должна начинаться с начала строки без пробельных либо иных символов.

- Простые команды пишутся одна на строку. Завершение строки - символ \n

- Команды с параметрами пишутся в одну строку. При этом сама команда является первым словом, параметрами - остальные слова

- Допускается использование нескольких одинаковых команд в сеансе соединения. 
  У каждой команды присутствует буфер, который накапливается в течении сеанса связи и сбрасывается(очищается) по:
  - завершении соединения
  - возникновении ошибки
  - командам quit, send, abort

- Регистр написания команд роли не играет.

- На каждую команду от клиента сервер отвечает либо 'ok', либо 'error'


Команды:

ok
    Отчёт об успешном выполнении команды
error <текст>
    Отчёт об ошибочном выполнении команды. При возникновении ошибки буфера всех команд сбрасываются!
    
    без комментариев

quit
exit
    Завершение сеанса. Подаётся клиентом. Клиент должен дождаться ответной команды "ok"

icq <номера>
    подготовительная команда для рассылки сообщения по протоколу icq

jabber <UIDы>
    подготовительная команда для рассылки сообщения по протоколу jabber

email <емайлы>
    подготовительная команда для рассылки сообщения по email-адресам

subject <текст>
    Заголовок рассылаемого сообщения. При множественной подаче команды текст накапливается без перевода строки (в одну строку)
body <текст>
    Содержимое письма. команда 'body' может повторяться, текст при этом будет накапливаться с новой строки

send
    Разослать сообщение

abort [команда]
    Отменить уже выполненную команду 'команда' (очистить буфер). Не отменяет команды 'send'.
    Без бараметров очищает буфера всех команд.
    
    
Примеры сессий.
Первый символ в строках примера обозначает направление команд. Пробел после первого символа добавлен для улучшения 
зрительного восприятия. В протоколе все команды должны быть без этих ведущих символов.
Знак "<" обозначает команду от клиента к серверу
Знак ">" обозначает команду от сервера к клиенту

1) Сессия рассылки сообщения по ICQ:
< icq 12345678 87654321
> ok
< icq 234567882
> ok
< subject превед
> ok
< subject медвед
> ok
< body Пиривед
> ok
< body медвед... Это тест.
> ok
< send
> ok
< quit
> ok

Комментарий:
будет разослано сообщение на номера 12345678 87654321 234567882. При этом содержимое сообщения будет таким (без линий):
-------------------------------------------------
превед медвед

Пиривед
медвед... Это тест.
-------------------------------------------------

2) Сессия рассылки сообщения по ICQ и jabber:
< icq 12345678 87654321
> ok
< icq 234567882
> ok
< jabber user1@jabber.server.net  user1@jabber.server.net 
> ok
< subject превед
> ok
< subject медвед
> ok
< body Пиривед
> ok
< body медвед... Это тест.
> ok
< send
> ok
< quit
> ok

Комментарий:
аналогично первому примеру, только сообщение будет разослано также аккаунтам сети jabber



3) Сессия комбинированной рассылки сообщения по ICQ и jabber:
< icq 12345678 87654321
> ok
< icq 234567882
> ok
< subject превед
> ok
< subject медвед
> ok
< body Пиривед
> ok
< body медвед... Это тест.
> ok
< send
> ok
< jabber user1@jabber.server.net  user1@jabber.server.net 
> ok
< subject превед
> ok
< body Жаббер - эта крута. лахи, кто иго не юзает
> ok
< send
> ok
< quit
> ok

Комментарий:
Сообщение на ICQ-аккаунты будет разослано аналогично первому примеру.
Дополнительно на jabber-аккаунты будет разослано сообщение следующего содержания:
-------------------------------------------------
превед

Жаббер - эта крута. лахи, кто иго не юзает
-------------------------------------------------

Примеры с e-mail не привожу. ибо всё симметрично.




