{% extends "employee/base.html" %}
{% block js %}
  <script type="text/javascript">
      function refresh_svg() {
        var svg=document.getElementById("thesvg");
        svg.height.baseVal.value = document.getElementsByTagName("body")[0].getBoundingClientRect().bottom - svg.getBoundingClientRect().top - 4;
      }
  </script>
{% endblock %}
{% block jsready %}
    {{ super() }}
    refresh_svg();
    document.getElementsByTagName("body")[0].setAttribute('onresize', 'refresh_svg();');
{% endblock %}
{% block css %}
    {{ super() }}
    svg #svgbg {
        fill: silver;
	stroke-width: 1;
	stroke: black;
    }
    svg g.head > line {
        stroke: yellow;
        stroke-width: 1;
    }
    svg g.head text {
        fill: black;
    }
    svg g.hcenter text {
        text-anchor: middle;
    }
    svg g.occupy rect {
        fill: lightgrey;
        stroke: blue;
        stroke-width: 1;
    }
    svg g.occupy text {
        fill: black;
        text-anchor: middle;
    }
{% endblock %}
{% block body_main %}
  <div id="topmenu">
    <center>
    <p> График кабинета №{{ room.pk }} (с {{ rs.begdate|date }}): </p>
    <p> Еще кабинетов: {% for i in rooms %}
        {% if i == room %}
            {{ i.pk }}
        {% else %}
            <a href="{{ url_for('rs_room', rs.id, i.pk) }}"> {{ i.pk }} </a>
        {% endif %}
    {% endfor %} </p>
    </center>
  </div>
  <table id="thetable">
    <tr>
      <td id="leftmenu" class="thecell" valign="top">
	{{ form.as_p() }}
      </td>
      <td id="canvas" class="thecell">  <!-- set height="1234" for compatibility-->
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" id="thesvg" height="100" onload="refresh_svg();">
  <rect id="svgbg" width="100%" height="100%"/>
  <g class="head">
    <!-- vertical grid -->
    {% set hx = 9 %}
    {% set dx = (100 - hx)/(hend - hbeg) %}
    {% for i in range(hend - hbeg) %}
	{% set x = hx + (loop.index0 * dx) %}
	<line x1="{{x}}%" y1="0" x2="{{x}}%" y2="100%"/>
	<g class="hcenter">
	<text x="{{x+(dx/2.0)}}%" y="0"><tspan dy="1.5ex"> {{i+hbeg}}:00 </tspan></text>
	</g>
    {% endfor %}
    {% set hy = 9 %}
    {% set dy = (100 - hy)/dows.count() %}
    <!-- horizontal grid:  -->
    {% for d in dows %}
	{% set y = hy + (loop.index0 * dy) %}
	<line x1="0" y1="{{y}}%" x2="100%" y2="{{y}}%"/>
	<a xlink:href="{{ url_for('rs_dow', rs.id, d.pk) }}" xlink:title="ГК на {{ d.name }}">
	<text x="0" y="{{y}}%"> <tspan dy="1.5ex"> {{ d.name }} </tspan> </text>
	</a>
    {% endfor %}
  </g>
  <g class="occupy">
    {% for entry in rse %}
        <!-- x = 9% + (((beg/60) - 8) * 6.5%); y = 9% + ((dow-1) * 13%) -->
        <a xlink:href="http://www.google.com" xlink:title="Edit this entry">
            <rect
                x="{{hx+(((entry.begtime/60.0)-hbeg)*dx)}}%"
                y="{{hx+((entry.dow.pk-1)*dy)}}%"
                width="{{(entry.endtime-entry.begtime)/60.0*dx}}%"
                height="{{dy}}%" rx="3" ry="3"
            >
                <title> {{ entry.specialty.name }} </title>
            </rect>
        </a>
        <text
            x="{{hx+((((entry.endtime+entry.begtime)/2.0/60.0)-hbeg)*dx)}}%"
            y="{{hy+((entry.dow.pk-1)*dy)}}%"
        > <tspan dy="1.5ex"> {{ entry.specialty.name }} </tspan> </text>
    {% endfor %}
    <!--a xlink:href="http://www.google.com" xlink:title="google">
        <rect x="22%" y="22%" width="16.25%" height="13%" rx="3" ry="3"> <title> Вт. 10:00-12:30 <br/> не распределено </title> </rect>
    </a>
    <text x="30.125%" y="22%"> <tspan dy="1.5ex"> Пример </tspan> </text-->
  </g>
</svg>
{% endblock %}
