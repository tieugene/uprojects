#summary comments for intosrv

= Как оно будет работать =

Вешаем audit-хук на каталог:
auditctl -a exit,always  -w /path/to -F success=yes

и в перле тупо парсим лог audit'а. В RH-подобных это
open(LOG, "tail -f /var/log/audit/audit.log | ");
То есть прога постоянно ждёт новых строчек в логе. 

KISS, однако. Inotify хорош был бы для mc, чтобы отслеживать изменения online 
(а не тупо жать ctrl+r, бля). Но для поставленной здесь задачи оно не подходит.

BTW, samba форкается потом с правами юзверя. Так что телемаркет.

= Что нужно для Slavaz =

- отследить изменения в каталоге, скажем, /path/to
- Распознать эти изменения (создание/изменение/удаление/перемещение/переименовывание).
- Понять, что много изменений - это одна операция (юзер копирует каталог с файлом. 
  В проге событий море, но для юзверя это одно событие. Один раз и оповестить).
- Оповестить об изменениях другого юзверя, который является владельцем подпапки в каталоге /path/to

Формат папки /path/to:

/path/to:
    user1(user1:users,2660)
    user2(user2:users,2660)
    ...

то есть на всех стоит sgid (назначить права группы на подкаталоги)

если user1 скинет что-то в /path/to/user2, то user2 оповеститься об изменении содержимого.
Если сам user2 колупается в своём подкаталоге, то никаких оповещений нет.

Степень подробности оповещения:
юзверя могут сами настраивать подробности оповещения:
- оповещать ли об удалении файлов
- оповещать ли об удалении каталогов
- оповещать ли об изменении по файлам или только по каталогам, в которых изменились файлы.

Юзверя сами выставляют свои координаты для оповещения (e-mail(s), ICQ(s), jabber(s)) и 
сами выставляют галки, по какому из каналов их оповещать (и оповещать ли вообще)

= Что нужно для TI_Eugene =
ахез. 
Чем подробнее и доходчивее распишет, тем больше шансов, что у поделия будет нормальная 
внутренняя структура и полноценный функционал.
----
действительно - хез что этому TI_Eugene...
То, что SlavaZ описал - ему тоже нужно. Хотя сама концепция передачи данных таким методом несколько порочна, но это уже в области организационной.
А вот что точно надо - чтобы при создании/удалении/изменении файлов в некоем каталоге и ниже вызывалась указанная мной программа. И чтобы туда (в идеале) передавался inode или хотя бы path, вместе с действием и инициатором.
Эта прога, например, будет вести журнал изменений файлов. Или добавлять в базу метаданных.